<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>lunar.js 测试页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .test-box { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>lunar.js 测试页面</h1>
    <p>通过此页面测试 lunar.js 库是否正常工作</p>
    
    <div class="test-box">
        <h2>测试 1: 文件加载状态</h2>
        <div id="file-status">检查中...</div>
    </div>
    
    <div class="test-box">
        <h2>测试 2: lunar.js 库测试</h2>
        <button onclick="testLunarJS()">运行 lunar.js 测试</button>
        <div id="lunar-status"></div>
    </div>
    
    <div class="test-box">
        <h2>测试 3: 八字计算测试</h2>
        <button onclick="testBaziCalculation()">运行八字计算测试</button>
        <div id="bazi-status"></div>
    </div>
    
    <div class="test-box">
        <h2>测试 4: 控制台输出</h2>
        <p>按 F12 打开浏览器开发者工具，查看控制台输出</p>
        <button onclick="logToConsole()">在控制台输出测试信息</button>
    </div>
    
    <div class="test-box">
        <h2>系统信息</h2>
        <p>当前时间: <span id="current-time"></span></p>
        <p>User Agent: <span id="user-agent"></span></p>
    </div>

    <script src="/libs/lunar.js"></script>
    <script src="/bazi-core.js"></script>
    <script src="/bazi-database.js"></script>
    
    <script>
        document.getElementById('current-time').textContent = new Date().toLocaleString();
        document.getElementById('user-agent').textContent = navigator.userAgent;
        
        function checkFileLoad() {
            const files = [
                { name: 'lunar.js', path: '/libs/lunar.js' },
                { name: 'style.css', path: '/style.css' },
                { name: 'script.js', path: '/script.js' },
                { name: 'bazi-core.js', path: '/bazi-core.js' },
                { name: 'bazi-database.js', path: '/bazi-database.js' }
            ];
            
            let results = '';
            files.forEach(file => {
                const xhr = new XMLHttpRequest();
                xhr.open('HEAD', file.path, false);
                try {
                    xhr.send();
                    if (xhr.status === 200) {
                        results += `<p class="success">✓ ${file.name} 加载成功 (${xhr.status})</p>`;
                    } else {
                        results += `<p class="error">✗ ${file.name} 加载失败 (${xhr.status})</p>`;
                    }
                } catch(e) {
                    results += `<p class="error">✗ ${file.name} 加载错误: ${e.message}</p>`;
                }
            });
            
            document.getElementById('file-status').innerHTML = results;
        }
        
        function testLunarJS() {
            const statusDiv = document.getElementById('lunar-status');
            statusDiv.innerHTML = '测试中...';
            
            setTimeout(() => {
                try {
                    if (typeof Solar === 'undefined') {
                        statusDiv.innerHTML = '<p class="error">✗ Solar 对象未定义，lunar.js 未正确加载</p>';
                        return;
                    }
                    
                    if (typeof Solar.fromDate !== 'function') {
                        statusDiv.innerHTML = '<p class="error">✗ Solar.fromDate 不是函数</p>';
                        return;
                    }
                    
                    const testDate = new Date(1990, 5, 15, 14, 30, 0);
                    const solar = Solar.fromDate(testDate);
                    
                    if (!solar) {
                        statusDiv.innerHTML = '<p class="error">✗ Solar.fromDate 返回空值</p>';
                        return;
                    }
                    
                    if (typeof solar.getLunar !== 'function') {
                        statusDiv.innerHTML = '<p class="error">✗ solar.getLunar 不是函数</p>';
                        return;
                    }
                    
                    const lunar = solar.getLunar();
                    
                    if (!lunar) {
                        statusDiv.innerHTML = '<p class="error">✗ solar.getLunar 返回空值</p>';
                        return;
                    }
                    
                    if (typeof lunar.getEightChar !== 'function') {
                        statusDiv.innerHTML = '<p class="error">✗ lunar.getEightChar 不是函数</p>';
                        return;
                    }
                    
                    statusDiv.innerHTML = '<p class="success">✓ lunar.js 基础功能测试通过</p>';
                    console.log('lunar.js 测试通过:', { solar, lunar });
                    
                } catch (error) {
                    statusDiv.innerHTML = `<p class="error">✗ lunar.js 测试失败: ${error.message}</p>`;
                    console.error('lunar.js 测试错误:', error);
                }
            }, 500);
        }
        
        function testBaziCalculation() {
            const statusDiv = document.getElementById('bazi-status');
            statusDiv.innerHTML = '计算中...';
            
            setTimeout(() => {
                try {
                    if (typeof Solar === 'undefined') {
                        statusDiv.innerHTML = '<p class="error">✗ Solar 对象未定义，请先确保lunar.js已正确加载</p>';
                        return;
                    }
                    
                    const testDate = new Date(1990, 5, 15, 14, 30, 0);
                    const solar = Solar.fromDate(testDate);
                    const lunar = solar.getLunar();
                    const eightChar = lunar.getEightChar();
                    
                    const year = eightChar.getYear();
                    const month = eightChar.getMonth();
                    const day = eightChar.getDay();
                    const hour = eightChar.getHour();
                    
                    statusDiv.innerHTML = `
                        <p class="success">✓ 八字计算成功！</p>
                        <p>测试日期: 1990年6月15日 14:30</p>
                        <p>八字结果: ${year} ${month} ${day} ${hour}</p>
                        <p>年柱: ${year}</p>
                        <p>月柱: ${month}</p>
                        <p>日柱: ${day}</p>
                        <p>时柱: ${hour}</p>
                    `;
                    
                    console.log('八字计算结果:', { year, month, day, hour });
                    
                } catch (error) {
                    statusDiv.innerHTML = `<p class="error">✗ 八字计算失败: ${error.message}</p>`;
                    console.error('八字计算错误:', error);
                }
            }, 500);
        }
        
        function logToConsole() {
            console.log('=== lunar.js 测试日志 ===');
            console.log('当前时间:', new Date());
            console.log('Solar 对象类型:', typeof Solar);
            
            if (typeof Solar !== 'undefined') {
                console.log('Solar.fromDate 类型:', typeof Solar.fromDate);
                
                try {
                    const testDate = new Date();
                    const solar = Solar.fromDate(testDate);
                    console.log('Solar 对象:', solar);
                } catch(e) {
                    console.error('Solar.fromDate 错误:', e);
                }
            }
            
            console.log('=== 测试结束 ===');
            alert('请按 F12 打开控制台查看输出');
        }
        
        window.addEventListener('load', checkFileLoad);
    </script>
</body>
</html>